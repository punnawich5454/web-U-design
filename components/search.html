<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <title>U-Dsign</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Prompt', sans-serif;
        }

        body {
            background-color: #ffffff;
        }

        .serch-container {
            background-color: rgb(253, 253, 253);
            width: 100%;
            display: flex;
            z-index: 2;
            display: flex;
            flex-direction: column;
        }

        .item-name {
            width: 100%;
            padding: 10px;
            display: flex;
            gap: 20px;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .item-name:hover {
            background-color: #f0f0f0;
        }

        .no-results {
            padding: 20px;
            text-align: center;
            color: #666;
        }
    </style>
</head>

<body>
    <div class="serch-container" id="search-results">
    </div>
</body>
<script>
    const API = 'https://wed-u-design-backend-production-65e0.up.railway.app'
    async function searchProducts(query) {
        if (!query) return;

        const response = await fetch(API + `/api/products/search?search=${encodeURIComponent(query)}`);
        const data = await response.json();

        const products = data.products || [];

        const searchResults = document.getElementById('search-results');
        if (!searchResults) return;

        searchResults.replaceChildren()

        const filteredProducts = products.filter(product =>
            product.name?.toLowerCase().startsWith(query.toLowerCase())
        );

        if (filteredProducts.length === 0) {
            const divResult = document.createElement('div')
            divResult.textContent = 'ไม่พบผลการค้นหา'
            searchResults.appendChild(divResult)
            return;
        }

        filteredProducts.forEach(product => {
            const div = document.createElement('a');
            div.href = `/page/service_detail.html?cat=${product.category_id}`;
            div.className = 'item-name';

            const i = document.createElement('i');
            i.classList.add('fa-solid', 'fa-magnifying-glass');

            const span = document.createElement('span');
            span.textContent = product.name;

            div.appendChild(i);
            div.appendChild(span);

            div.addEventListener('click', (e) => {
                e.preventDefault();
                window.parent.location.href = `/page/service_detail.html?cat=${product.category_id}#${encodeURIComponent(product.name)}`;
            });

            searchResults.appendChild(div);
        });
    }

    const urlParams = new URLSearchParams(window.location.search);
    const queryFromUrl = urlParams.get('query');
    if (queryFromUrl) {
        searchProducts(queryFromUrl);
    }

    

</script>

</html>